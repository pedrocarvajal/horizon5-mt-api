#!/bin/bash
set -e

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$' || true)

if [ -z "$STAGED_FILES" ]; then
  exit 0
fi

echo "[pre-commit] Formatting staged Python files..."
echo "$STAGED_FILES" | xargs ruff format
echo "$STAGED_FILES" | xargs ruff check --fix

echo "[pre-commit] Re-staging formatted files..."
echo "$STAGED_FILES" | xargs git add

echo "[pre-commit] Running linter checks..."
make run-linter-checks

echo "[pre-commit] All checks passed"
