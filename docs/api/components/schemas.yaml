SuccessEnvelope:
  type: object
  required: [success]
  properties:
    success:
      type: boolean
      const: true
    message:
      type: string
    data: {}
    meta:
      type: object

LoginWithCredentials:
  type: object
  required: [email, password]
  properties:
    email:
      type: string
      format: email
      minLength: 5
      maxLength: 254
      default: "root@mail.co"
    password:
      type: string
      format: password
      minLength: 8
      maxLength: 128
      default: "123456789*"

LoginWithApiKey:
  type: object
  required: [api_key]
  properties:
    api_key:
      type: string
      minLength: 1
      maxLength: 256
      description: Plaintext API key.

CreateApiKeyRequest:
  type: object
  required: [name]
  properties:
    name:
      type: string
      minLength: 1
      maxLength: 100
      description: Human-readable label for the API key.
    allowed_ips:
      type: array
      items:
        type: string
        format: ipv4
      maxItems: 20
      default: []
      description: IP whitelist. Empty array allows all IPs.
    expires_at:
      type: string
      format: date-time
      nullable: true
      description: Optional expiration date. Null means no expiration.

UpdateApiKeyRequest:
  type: object
  properties:
    name:
      type: string
      minLength: 1
      maxLength: 100
    allowed_ips:
      type: array
      items:
        type: string
        format: ipv4
      maxItems: 20
    is_active:
      type: boolean
    expires_at:
      type: string
      format: date-time
      nullable: true

ApiKey:
  type: object
  properties:
    id:
      type: string
      format: uuid
    name:
      type: string
    prefix:
      type: string
      description: First 8 characters of the key for identification.
    allowed_ips:
      type: array
      items:
        type: string
    is_active:
      type: boolean
    is_expired:
      type: boolean
    expires_at:
      type: string
      format: date-time
      nullable: true
    last_used_at:
      type: string
      format: date-time
      nullable: true
    created_at:
      type: string
      format: date-time
    updated_at:
      type: string
      format: date-time

PushEventRequest:
  type: object
  required: [key, payload]
  properties:
    key:
      $ref: "#/EventKeyEnum"
    payload:
      type: object
      description: Validated against the event key schema. Max 65536 bytes, max 5 nesting levels.

AckEventRequest:
  type: object
  properties:
    response:
      type: object
      nullable: true
      description: Optional response data. Max 65536 bytes, max 5 nesting levels.

Event:
  type: object
  properties:
    id:
      type: string
    consumer_id:
      type: string
      nullable: true
    account_id:
      type: string
    user_id:
      type: string
    key:
      $ref: "#/EventKeyEnum"
    payload:
      type: object
    response:
      type: object
      nullable: true
    status:
      $ref: "#/EventStatus"
    delivered_at:
      type: string
      format: date-time
      nullable: true
    processed_at:
      type: string
      format: date-time
      nullable: true
    attempts:
      type: integer
    created_at:
      type: string
      format: date-time
    updated_at:
      type: string
      format: date-time

EventKeyEnum:
  type: string
  enum:
    - post.order
    - get.order
    - put.order
    - delete.order
    - get.account
    - patch.account.disable
    - patch.account.enable

EventStatus:
  type: string
  enum: [pending, delivered, processed, failed]

UpsertAccountRequest:
  type: object
  required: [account_id]
  properties:
    account_id:
      type: integer
    broker:
      type: string
      maxLength: 255
    server:
      type: string
      maxLength: 255
    currency:
      type: string
      maxLength: 10
    leverage:
      type: integer
      minimum: 1
    balance:
      type: number
      format: decimal
    equity:
      type: number
      format: decimal
    margin:
      type: number
      format: decimal
    free_margin:
      type: number
      format: decimal
    profit:
      type: number
      format: decimal
    margin_level:
      type: number
      format: decimal

UpsertStrategyRequest:
  type: object
  required: [id, account_id, symbol, prefix, name, magic_number, balance]
  properties:
    id:
      type: string
      format: uuid
    account_id:
      type: integer
    symbol:
      type: string
      maxLength: 50
    prefix:
      type: string
      maxLength: 50
    name:
      type: string
      maxLength: 255
    magic_number:
      type: integer
    balance:
      type: number
      format: decimal

CreateHeartbeatRequest:
  type: object
  required: [account_id, event, system]
  properties:
    account_id:
      type: integer
    strategy_id:
      type: string
      format: uuid
      nullable: true
    event:
      type: string
      enum: [on_init, on_running, on_deinit, on_error]
    system:
      type: string
      enum: [strategy, system]

UpsertOrderRequest:
  type: object
  required: [id, account_id, symbol, side, status, volume]
  properties:
    id:
      type: string
      format: uuid
    account_id:
      type: integer
    strategy_id:
      type: string
      format: uuid
      nullable: true
    deal_id:
      type: integer
      nullable: true
    position_id:
      type: integer
      nullable: true
    source:
      type: string
      maxLength: 50
    symbol:
      type: string
      maxLength: 50
    side:
      type: string
      maxLength: 10
    status:
      type: string
      enum: [pending, open, closing, closed, cancelled]
    is_market_order:
      type: boolean
      default: false
    volume:
      type: number
      format: decimal
    signal_price:
      type: number
      format: decimal
      nullable: true
    open_at_price:
      type: number
      format: decimal
      nullable: true
    open_price:
      type: number
      format: decimal
      nullable: true
    close_price:
      type: number
      format: decimal
      nullable: true
    take_profit:
      type: number
      format: decimal
      nullable: true
    stop_loss:
      type: number
      format: decimal
      nullable: true
    profit:
      type: number
      format: decimal
      nullable: true
    gross_profit:
      type: number
      format: decimal
      nullable: true
    commission:
      type: number
      format: decimal
      nullable: true
    swap:
      type: number
      format: decimal
      nullable: true
    close_reason:
      type: string
      enum: [tp, sl, expert, client, mobile, web, unknown]
      nullable: true
    signal_at:
      type: string
      format: date-time
      nullable: true
    opened_at:
      type: string
      format: date-time
      nullable: true
    closed_at:
      type: string
      format: date-time
      nullable: true

CreateLogRequest:
  type: object
  required: [account_id, level, message]
  properties:
    account_id:
      type: integer
    strategy_id:
      type: string
      format: uuid
      nullable: true
    level:
      type: string
      maxLength: 20
    message:
      type: string
      maxLength: 5000

CreateAccountSnapshotRequest:
  type: object
  required: [account_id, balance, equity, profit, margin_level, open_positions, drawdown_pct, daily_pnl, floating_pnl, open_order_count, exposure_lots]
  properties:
    account_id:
      type: integer
    balance:
      type: number
      format: decimal
    equity:
      type: number
      format: decimal
    profit:
      type: number
      format: decimal
    margin_level:
      type: number
      format: decimal
    open_positions:
      type: integer
      minimum: 0
    drawdown_pct:
      type: number
      format: decimal
    daily_pnl:
      type: number
      format: decimal
    floating_pnl:
      type: number
      format: decimal
    open_order_count:
      type: integer
      minimum: 0
    exposure_lots:
      type: number
      format: decimal

CreateStrategySnapshotRequest:
  type: object
  required: [account_id, strategy_id, nav, drawdown_pct, daily_pnl, floating_pnl, open_order_count, exposure_lots]
  properties:
    account_id:
      type: integer
    strategy_id:
      type: string
      format: uuid
    nav:
      type: number
      format: decimal
    drawdown_pct:
      type: number
      format: decimal
    daily_pnl:
      type: number
      format: decimal
    floating_pnl:
      type: number
      format: decimal
    open_order_count:
      type: integer
      minimum: 0
    exposure_lots:
      type: number
      format: decimal

MediaFile:
  type: object
  properties:
    id:
      type: string
    account_id:
      type: string
    user_id:
      type: string
    file_name:
      type: string
    original_name:
      type: string
    content_type:
      type: string
    size:
      type: integer
    expires_at:
      type: string
      format: date-time
    created_at:
      type: string
      format: date-time
