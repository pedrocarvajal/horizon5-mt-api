upsert:
  post:
    tags: [Orders]
    summary: Upsert order
    description: |
      Creates or updates a trading order. Orders are stored in MongoDB.

      If an order with the given `id` already exists and its `account_id` matches,
      it is updated. Otherwise, a new order is created.

      **Permissions:** `root` or `producer`
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas.yaml#/UpsertOrderRequest"
          examples:
            new_order:
              summary: Create a new buy order
              value:
                id: "550e8400-e29b-41d4-a716-446655440000"
                account_id: 12345678
                strategy_id: "660e8400-e29b-41d4-a716-446655440000"
                symbol: "EURUSD"
                side: "buy"
                status: "open"
                volume: 0.10
                open_price: 1.10500
                stop_loss: 1.10000
                take_profit: 1.11000
                opened_at: "2026-02-27T10:30:00Z"
            close_order:
              summary: Update order to closed
              value:
                id: "550e8400-e29b-41d4-a716-446655440000"
                account_id: 12345678
                symbol: "EURUSD"
                side: "buy"
                status: "closed"
                volume: 0.10
                close_price: 1.10800
                profit: 30.00
                close_reason: "tp"
                closed_at: "2026-02-27T12:00:00Z"
    responses:
      "201":
        description: Order created
        content:
          application/json:
            example:
              success: true
              data:
                id: "550e8400-e29b-41d4-a716-446655440000"
      "200":
        description: Order updated
        content:
          application/json:
            example:
              success: true
              data:
                id: "550e8400-e29b-41d4-a716-446655440000"
      "403":
        description: Account belongs to another user
